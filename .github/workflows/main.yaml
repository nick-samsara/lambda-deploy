name: Lambda Deployment

on: 
  push:
    branches:
      - master
      - main
    paths:
      - 'lambda_function/hello_earth/**'
      - 'lambda_function/hello_world/**'
jobs:
  lambda_deployment:
    runs-on: self-hosted

    steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Deploy hello_world
          if:  contains(github.event.head_commit.modified, 'lambda_function/hello_world')
          run: |
            cd lambda_function/hello_world
            zip -r hello_world.zip ./*
            aws s3 cp hello_world.zip s3://bted-lambda-deploy-cicd/hello_world.zip
            aws lambda update-function-code --function-name demo --s3-bucket bted-lambda-deploy-cicd --s3-key hello_world.zip

        - name: Deploy hello_earth
          if: contains(github.event.head_commit.modified, 'lambda_function/hello_earth')
          run: |
            cd lambda_function/hello_earth
            zip -r hello_earth.zip ./*
            aws s3 cp lambda_package.zip s3://bted-lambda-deploy-cicd/hello_earth.zip
            aws lambda update-function-code --function-name demo2 --s3-bucket bted-lambda-deploy-cicd --s3-key hello_earth.zip

# on: 
#   push:
#     branches:
#       - master
#       - main

# jobs:
#   deploy:
#     name: Upload to Amazon S3
#     runs-on: ubuntu-latest
#     # These permissions are needed to interact with GitHub's OIDC Token endpoint.
#     permissions:
#       id-token: write
#       contents: read
#     steps:
#     - name: Checkout
#       uses: actions/checkout@v3
#     - name: Configure AWS credentials from Test account
#       uses: aws-actions/configure-aws-credentials@v4
#       with:
#         role-to-assume: arn:aws:iam::849340316486:role/lambda-deploy-github
#         aws-region: us-west-1
#     - name: Copy files to the test website with the AWS CLI
#       run: |
#         aws s3api list-buckets